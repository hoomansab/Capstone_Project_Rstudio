---
title: "Martensite"
format: html
editor: visual
---

```{r}
# Load the dataset
dataset <- read.csv("/Users/hoomansabarou/Downloads/Martensite Start-Temp.csv")
head(dataset)

```

```{r}
# Check for missing values
sum(is.na(dataset))

```

```{r}
# Check the structure of the dataset
str(dataset)

```

```{r}
# Summary statistics of the dataset
summary(dataset)

```

```{r}
# Correlation between variables
cor_matrix <- cor(dataset)
cor_matrix

```

```{r}
# Scatter plot for one element vs Ms
plot(dataset$C, dataset$Ms, xlab = "C", ylab = "Martensite Start Temp")

```

```{r}
# Plot histogram of Ms (Martensite start temperature)
hist(dataset$Ms, 
     main = "Distribution of Martensite Start Temperature (Ms)", 
     xlab = "Martensite Start Temperature (Ms)", 
     col = "lightblue", 
     border = "black", 
     breaks = 30)

```

```{r}
# Filter the dataset for Ms between 300°C and 800°C
filtered_dataset <- subset(dataset, Ms >= 300 & Ms <= 800)

```

```{r}
# Build the updated GLM model using filtered data
updated_model <- glm(Ms ~ C + Ni + Mn + Mo + Si + Cr + V + Co, data = filtered_dataset, family = gaussian)

# Summarize the updated model
summary(updated_model)

```

```{r}
# Check residuals with a QQ plot
qqnorm(residuals(updated_model))
qqline(residuals(updated_model), col = "red")

# Histogram of residuals
hist(residuals(updated_model), main = "Residuals Distribution", xlab = "Residuals")


```

```{r}
# Identify outliers
outlier_residuals <- which(abs(residuals(updated_model)) > 2 * sd(residuals(updated_model)))
dataset[outlier_residuals, ]

```

```{r}
# Remove rows where C is 0
filtered_dataset_no_C0 <- subset(filtered_dataset, C != 0)

# Build the updated GLM model using the filtered data
updated_model_no_C0 <- glm(Ms ~ C + Ni + Mn + Mo + Si + Cr + V + Co, data = filtered_dataset_no_C0, family = gaussian)

# Summarize the updated model
summary(updated_model_no_C0)

```

```{r}
# Update the GLM model by removing Co and Mo, and adding an interaction between C and Mn
updated_model_interaction <- glm(Ms ~ C * Mn + Ni + Si + Cr + V, 
                                 data = filtered_dataset_no_C0, family = gaussian)

# Summarize the updated model
summary(updated_model_interaction)

```

```{r}
# Update the model: remove V, and add interaction between C and Ni
updated_model_C_Ni_interaction <- glm(Ms ~ C * Mn + C * Ni + Si + Cr, 
                                      data = filtered_dataset_no_C0, 
                                      family = gaussian)

# Summarize the updated model
summary(updated_model_C_Ni_interaction)

```

```{r}
library(classpackage)
# Perform ANOVA on the updated model
anova_check(updated_model_C_Ni_interaction)

```

```{r}
library(glmtoolbox)
(adjR2(updated_model_C_Ni_interaction))
```

```{r}
cooks(updated_model_C_Ni_interaction)
```

```{r}
# Investigate the influential points
influential_points <- c(1081, 685, 686)
filtered_dataset_no_C0[influential_points, ]


```

```{r}
# Remove the influential points
filtered_dataset_no_influential <- filtered_dataset_no_C0[-c(1081, 685, 686), ]

# Rebuild the model after removing the influential points
updated_model_no_influential <- glm(Ms ~ C * Mn + C * Ni + Si + Cr, 
                                    data = filtered_dataset_no_influential, 
                                    family = gaussian)

# Summarize the updated model
summary(updated_model_no_influential)

```

```{r}
# Investigate the observations with moderate Cook's Distance
moderate_influential_points <- c(1132, 1188, 1061)
filtered_dataset_no_C0[moderate_influential_points, ]

```

```{r}
# Apply the residuals check to the correct dataset (filtered_dataset_no_influential)
filtered_dataset_no_influential <- filtered_dataset_no_influential %>% 
  mutate(outlier = if_else(abs(rstandard(updated_model_no_influential)) > 2.5, 
                           "Suspected", "Not Suspected"))

```

```{r}

filtered_dataset_no_influential %>% count(outlier)
```

```{r}
library(ggplot2)
filtered_dataset_no_influential %>% ggplot(aes(x = C, y = Ms, color = outlier)) +
  geom_point() + 
  scale_color_manual(values = c("#999999", "#000000")) +
  labs(x = "Carbon", y = "Martensite Starting Temperature", color = "Outlier") +
  theme_bw()
```

```{r}
anova_check(updated_model_no_influential)

```

```{r}
#Check Multicollinearity
car::vif(updated_model_no_influential)

```

```{r}
#Removing identified outliers
filtered_dataset_no_influential_no_outlier <- filtered_dataset_no_influential %>% filter(outlier == "Not Suspected")

updated_model_no_influential_2 <- glm(Ms ~ C * Mn + C * Ni + Si + Cr, 
                                    data = filtered_dataset_no_influential_no_outlier, 
                                    family = gaussian)

summary(updated_model_no_influential_2)

```

```{r}
anova_check(updated_model_no_influential_2)
```

```{r}
cooks(updated_model_no_influential_2)
```

```{r}
summary(filtered_dataset_no_influential_no_outlier[c("Ms", "C", "Mn", "Ni", "Si", "Cr")])
```

```{r}
#write.csv(summary(filtered_dataset_no_influential_no_outlier[c("Ms", "C", "Mn", "Ni", "Si", "Cr")]), "NewTable.csv")
```
